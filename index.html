<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For My Pwintheth ðŸ’–</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #ff9a9e, #fad0c4);
        font-family: 'Georgia', serif;
        text-align: center;
        color: #fff;
        overflow-x: hidden;
    }

    h1 {
        margin-top: 20px;
    }

    .puzzle-container {
        width: 300px;
        height: 300px;
        margin: 20px auto;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 2px;
    }

    .tile {
        width: 100px;
        height: 100px;
        background-image: url('us.png');
        background-size: 300px 300px;
        cursor: pointer;
    }

    .empty {
        background: transparent;
        cursor: default;
    }

    #proposal {
        display: none;
        margin-top: 30px;
    }

    button {
        padding: 10px 20px;
        margin: 10px;
        border: none;
        border-radius: 25px;
        font-size: 1em;
        cursor: pointer;
    }

    .yes {
        background-color: #ff4b5c;
        color: white;
    }

    .no {
        background-color: #444;
        color: white;
        position: relative;
    }

    canvas {
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
    }
</style>
</head>
<body>

<h1>Happy Valentine's Day, Basya ðŸ’–</h1>
<p>Put the puzzle together, pwintheth ðŸ§©</p>

<div class="puzzle-container" id="puzzle"></div>

<div id="proposal">
    <h2>Will you be my Valentine? ðŸ’˜</h2>
    <button class="yes" onclick="sayYes()">Yes ðŸ’–</button>
    <button class="no" onmouseover="moveNo(this)">No ðŸ˜¢</button>
</div>

<canvas id="confetti"></canvas>

<script>
    const puzzle = document.getElementById("puzzle");
    let tiles = [];
    let emptyIndex = 8;

    function createPuzzle() {
        tiles = [...Array(9).keys()];
        shuffle(tiles);
        render();
    }

    function render() {
        puzzle.innerHTML = "";
        tiles.forEach((num, index) => {
            const tile = document.createElement("div");

            if (num === 8) {
                tile.classList.add("tile", "empty");
            } else {
                tile.classList.add("tile");
                const x = (num % 3) * -100;
                const y = Math.floor(num / 3) * -100;
                tile.style.backgroundPosition = `${x}px ${y}px`;
                tile.addEventListener("click", () => moveTile(index));
            }

            puzzle.appendChild(tile);
        });
    }

    function moveTile(index) {
        const validMoves = [
            emptyIndex - 1,
            emptyIndex + 1,
            emptyIndex - 3,
            emptyIndex + 3
        ];

        if (validMoves.includes(index)) {
            [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
            emptyIndex = index;
            render();
            checkWin();
        }
    }

   function shuffle(array) {
    // Start with the solved puzzle
    array = [...Array(9).keys()];

    // Make 1000 random valid moves from the solved state
    let empty = 8; // empty tile index
    for (let i = 0; i < 1000; i++) {
        const moves = [];
        if (empty % 3 !== 0) moves.push(empty - 1); // left
        if (empty % 3 !== 2) moves.push(empty + 1); // right
        if (empty > 2) moves.push(empty - 3);       // up
        if (empty < 6) moves.push(empty + 3);       // down

        const move = moves[Math.floor(Math.random() * moves.length)];
        [array[move], array[empty]] = [array[empty], array[move]];
        empty = move;
    }

    tiles = array;
    emptyIndex = tiles.indexOf(8);
}


    function checkWin() {
        if (tiles.every((val, i) => val === i)) {
            document.getElementById("proposal").style.display = "block";
        }
    }

    function sayYes() {
    startConfetti();

    // Fade out puzzle and proposal
    const puzzleDiv = document.getElementById("puzzle");
    const proposalDiv = document.getElementById("proposal");
    
    puzzleDiv.style.transition = "opacity 1s";
    proposalDiv.style.transition = "opacity 1s";
    
    puzzleDiv.style.opacity = 0;
    proposalDiv.style.opacity = 0;

    setTimeout(() => {
        puzzleDiv.style.display = "none";
        proposalDiv.style.display = "none";

        // Create container for final message and image
        const finalContainer = document.createElement("div");
        finalContainer.id = "finalMessage";
        finalContainer.style.textAlign = "center";
        finalContainer.style.marginTop = "50px";
        finalContainer.style.opacity = 0;
        finalContainer.style.transition = "opacity 2s";

        // Add message first, image below
        finalContainer.innerHTML = `
            <div style="font-size: 2em; color: #fff; font-family: 'Georgia', serif; margin-bottom: 20px;">
                YAY!!! ðŸ’–<br>
                I can't wait to celebrate with you.<br>
                I love you, Basya! ðŸ’˜
            </div>
            <img id="finalImage" src="final.jpg" alt="Our special moment" style="max-width: 300px; border-radius: 20px; transform: scale(0.8); transition: transform 1.5s;">
        `;

        document.body.appendChild(finalContainer);

        // Fade in container
        setTimeout(() => {
            finalContainer.style.opacity = 1;

            // Animate image scale
            const img = document.getElementById("finalImage");
            setTimeout(() => {
                img.style.transform = "scale(1)";
            }, 200);
        }, 50);

    }, 1000); // Wait for fade-out
}



    function moveNo(button) {
        button.style.position = "absolute";
        button.style.left = Math.random() * 300 + "px";
        button.style.top = Math.random() * 200 + "px";
    }

    // ðŸŽ‰ CONFETTI LOGIC
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let confetti = [];

    function startConfetti() {
        for (let i = 0; i < 200; i++) {
            confetti.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                r: Math.random() * 6 + 4,
                d: Math.random() * 200,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                tilt: Math.random() * 10 - 10
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        confetti.forEach((c, i) => {
            ctx.beginPath();
            ctx.fillStyle = c.color;
            ctx.fillRect(c.x, c.y, c.r, c.r);
        });

        updateConfetti();
        requestAnimationFrame(animateConfetti);
    }

    function updateConfetti() {
        confetti.forEach((c) => {
            c.y += 3;
            if (c.y > canvas.height) {
                c.y = -10;
            }
        });
    }

    createPuzzle();
</script>

</body>
</html>
